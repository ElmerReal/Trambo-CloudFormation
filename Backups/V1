
Description:  Template para instancias.

Parameters: 
  RefSubnetPublica: 
    Description: "Subnet Publica"
    Type: String
  
  RefSG: 
    Description: "Security group"
    Type: String
  
  EndpointBD:
    Description: "Endpoint RDS"
    Type: String

Resources:
  MyEC2Instance: 
    Type: AWS::EC2::Instance
    Properties: 
      ImageId: "ami-0e8c04af2729ff1bb"
      KeyName: "Key"
      InstanceType: t2.micro
      NetworkInterfaces: 
      - AssociatePublicIpAddress: "true"
        DeviceIndex: "0"
        SubnetId: !Ref RefSubnetPublica
        GroupSet: 
          - !Ref RefSG
      UserData:
        Fn::Base64: 
          !Sub |
            #!/bin/bash
            yum update -y
            yum install httpd -y
            service httpd start
            chkconfig httpd on
            wget https://wordpress.org/latest.tar.gz
            tar -xzf latest.tar.gz
            cd wordpress
            cp wp-config-sample.php wp-config.php
            cat >> wp-config.php <<EOL
            define( 'DB_NAME', 'wordpress' );
            define( 'DB_USER', 'DBUsername' );
            define( 'DB_PASSWORD', 'DBPasswords' );
            define( 'define( 'DB_HOST', '${EndpointBD}' );', 'DBPasswords' );
            EOL
            amazon-linux-extras install -y lamp-mariadb10.2-php7.2 php7.2
            cd /home/ec2-user
            cp -r wordpress/* /var/www/html/
            service httpd restart
      Tags:
        - Key: Name
          Value: Instancia para wordpress
        - Key: Owner
          Value: elmerreal98@gmail.com 